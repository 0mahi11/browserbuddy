(()=>{"use strict";var e={963:(e,t,n)=>{function r(e,t,n,r,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function a(e){r(s,o,i,a,u,"next",e)}function u(e){r(s,o,i,a,u,"throw",e)}a(void 0)}))}}function i(){return(i=o((function*(e,t,n){return yield browser.tabs.sendMessage(e,t,n)}))).apply(this,arguments)}function s(e,t){return a.apply(this,arguments)}function a(){return a=o((function*(e,t){const n=(yield browser.tabs.query({url:["https://highseas.hackclub.com/*","https://high-seas.hackclub.dev/*"]})).flatMap((n=>n.id?function(e,t,n){return i.apply(this,arguments)}(n.id,e,t):[]));return yield Promise.all(n)})),a.apply(this,arguments)}n.d(t,{mp:()=>s})},854:(e,t,n)=>{function r(e,t,n,r,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function a(e){r(s,o,i,a,u,"next",e)}function u(e){r(s,o,i,a,u,"throw",e)}a(void 0)}))}}n.d(t,{Q$:()=>f,YG:()=>w,aG:()=>y,bO:()=>a,fo:()=>m,lb:()=>u,qp:()=>b,s0:()=>s,z8:()=>i});const i="favouriteItems",s="shopItems",a="numDoubloons",u="cachedShips";function c(e,t){return l.apply(this,arguments)}function l(){return(l=o((function*(e,t){return(yield t.get(e))[e]}))).apply(this,arguments)}function p(e,t,n){return d.apply(this,arguments)}function d(){return(d=o((function*(e,t,n){yield n.set({[e]:t})}))).apply(this,arguments)}function f(e){return h.apply(this,arguments)}function h(){return(h=o((function*(e){return yield c(e,browser.storage.local)}))).apply(this,arguments)}function y(e,t){return v.apply(this,arguments)}function v(){return(v=o((function*(e,t){yield p(e,t,browser.storage.local)}))).apply(this,arguments)}function b(){return g.apply(this,arguments)}function g(){return(g=o((function*(){return yield c(i,browser.storage.sync)}))).apply(this,arguments)}function m(e){return k.apply(this,arguments)}function k(){return(k=o((function*(e){yield p(i,e,browser.storage.sync)}))).apply(this,arguments)}function w(e){const t=new Map;for(const n of e)t.set(n.id,n);const n=[];for(const e of t.values()){if(null!==e.reshippedFromId)continue;const o=[];let i=e;for(;;){var r;if(o.push({id:i.id,credited_hours:i.credited_hours,shipStatus:i.shipStatus,doubloonPayout:null!==(r=i.doubloonPayout)&&void 0!==r?r:0,paidOut:i.paidOut}),!i.reshippedToId)break;const e=t.get(i.reshippedToId);if(!e){console.error(`Could not find ship id ${i.reshippedToId}, required by ship ${i.id}`);break}i=e}const s=o.reduce(((e,t)=>e+t.doubloonPayout),0),a=o.reduce(((e,t)=>e+(t.paidOut?t.credited_hours:0)),0),u=s>0&&a>0?s/a:null;n.push({title:i.title,paidHours:a,totalDoubloons:s,doubloonsPerHour:u,screenshotUrl:i.screenshotUrl,deploymentUrl:i.deploymentUrl,repoUrl:i.repoUrl,updates:o})}return n}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r=n(963),o=n(854);function i(e,t,n,r,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var s=e.apply(t,n);function a(e){i(s,r,o,a,u,"next",e)}function u(e){i(s,r,o,a,u,"throw",e)}a(void 0)}))}}function a(e,t){return u.apply(this,arguments)}function u(){return(u=s((function*(e,t){(yield(0,o.Q$)(e))!==t&&((0,o.aG)(e,t),(0,r.mp)({id:"injectUpdatedData"}))}))).apply(this,arguments)}function c(e,t){switch(e){case o.z8:{const e=JSON.parse(t);if(!e||!Array.isArray(e))break;console.log("Updating synced favourites: ",e),(0,o.fo)(e);break}case"cache.personTicketBalance":{var n;const e=null===(n=JSON.parse(t))||void 0===n?void 0:n.value;if(!Number.isInteger(e))break;console.log("Updating cached doubloons amount: ",e),a(o.bO,e);break}case"cache.shopItems":{const e=JSON.parse(t).value;if(!e||!Array.isArray(e))break;const n=e.map((e=>({id:e.id,priceUs:e.priceUs,priceGlobal:e.priceGlobal})));console.log("Updating cached shop items: ",n),a(o.s0,n);break}case"cache.ships":{const e=JSON.parse(t).value;if(!e||!Array.isArray(e)){console.log("Ship cache cleared");break}const n=(0,o.YG)(e);console.log("Updating cached ship data: ",n),a(o.lb,n);break}}}function l(){return(l=s((function*(e){const t=yield(0,o.qp)();for(const[n,r]of e.localStorage)n===o.z8&&t||c(n,r);const n=yield(0,o.qp)();return n?(console.log("Setting local favourites to synced value: ",n),{id:"setFavourites",value:n}):{id:"null"}}))).apply(this,arguments)}browser.runtime.onMessage.addListener(((e,t,n)=>{switch(e.id){case"visitedSite":return function(e){return l.apply(this,arguments)}(e).then((e=>n(e))),!0;case"storageUpdated":c(e.key,e.value);break;case"null":break;default:console.error("Unknown internal message: ",e)}})),browser.runtime.onMessageExternal.addListener((e=>{switch(e.id){case"storageUpdated":c(e.key,e.value);break;case"null":break;default:console.error("Unknown external message: ",e)}}))})();